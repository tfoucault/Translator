TRANSLATOR_NS={},function(){var a={ACCOUNT_KEY:"t1TEjjPDtmzfJsY4hwndo/1wIUfrazV4900sR5MMmH4",BASE_URL:"https://api.datamarket.azure.com/Bing/MicrosoftTranslator/v1",TRANSLATE:{VERB:"Translate",PARAMS:{Text:"",From:"",To:""},PARAM:{TEXT:function(b){a.TRANSLATE.PARAMS.Text="",a.TRANSLATE.PARAMS.Text=b},FROM:function(b){a.TRANSLATE.PARAMS.From="",a.TRANSLATE.PARAMS.From=b},TO:function(b){a.TRANSLATE.PARAMS.To="",a.TRANSLATE.PARAMS.To=b}}},LANGUAGES:{VERB:"GetLanguagesForTranslation",PARAMS:[]},DETECT:{VERB:"Detect",PARAMS:{Text:""},PARAM:{TEXT:function(b){a.DETECT.PARAMS.Text="",a.DETECT.PARAMS.Text=b}}}},b=function(a){this.name="Translator.error",this.message=a};b.prototype=new Error,b.prototype.constructor=b,TRANSLATOR_NS.USER_SETTINGS={LANGUAGE:"EN",POPOVER:{WIDTH:300,HEIGHT:100,BORDER:"red"}},TRANSLATOR_NS.ERROR={NO_CONTENT_TO_TRANSLATE:"",SOURCE_LANGUAGE_UNDEFINED:"",TARGET_LANGUAGE_UNDEFINED:"",LANGUAGE_ISO_UNDEFINED:"",API_BASE_URL_UNDEFINED:"",API_VERB_UNDEFINED:"",API_PARAMS_UNDEFINED:"",API_KEY_UNDEFINED:"",USER_LANGUAGE_UNDEFINED:"",NO_CONTENT_TO_DETECT:""},TRANSLATOR_NS.FIELD={TRANSLATION_OF:""},TRANSLATOR_NS.ACTION={GET_TRANSLATION_FILES:0},TRANSLATOR_NS.utils=TRANSLATOR_NS.utils||{},TRANSLATOR_NS.utils.setLanguage=function(a){if("undefined"==typeof a||null===a||0===a.length)throw new b(TRANSLATOR_NS.ERROR.LANGUAGE_ISO_UNDEFINED);TRANSLATOR_NS.USER_SETTINGS.LANGUAGE=a,chrome.runtime.sendMessage({action:TRANSLATOR_NS.ACTION.GET_TRANSLATION_FILES,params:[a]},function(a){if("undefined"==typeof a||null===a)throw new b("Sorry, this plugin is not translated for your language.English is set as default language for fields and error message.");for(var c in TRANSLATOR_NS.ERROR)TRANSLATOR_NS.ERROR[c]=a.ERROR[c]||"";for(var c in TRANSLATOR_NS.FIELD)TRANSLATOR_NS.FIELD[c]=a.FIELD[c]||""})},TRANSLATOR_NS.utils.getUserLanguage=function(){var a=window.navigator.userLanguage||window.navigator.language;if("undefined"==typeof a||null===a||0===a.length)throw new b(TRANSLATOR_NS.ERROR.USER_LANGUAGE_UNDEFINED);return a.substr(0,2)},TRANSLATOR_NS.utils.translate=function(c,d,e,f,g){if("undefined"==typeof c||null===c||0===c.length)throw new b(TRANSLATOR_NS.ERROR.NO_CONTENT_TO_TRANSLATE);if("undefined"==typeof d||null===d||0===d.length)throw new b(TRANSLATOR_NS.ERROR.SOURCE_LANGUAGE_UNDEFINED);if("undefined"==typeof e||null===e||0===e.length)throw new b(TRANSLATOR_NS.ERROR.TARGET_LANGUAGE_UNDEFINED);a.TRANSLATE.PARAM.TEXT(c),a.TRANSLATE.PARAM.FROM(d),a.TRANSLATE.PARAM.TO(e),TRANSLATOR_NS.utils.sendRequest(a.BASE_URL,a.TRANSLATE.VERB,a.TRANSLATE.PARAMS,a.ACCOUNT_KEY,f,g)},TRANSLATOR_NS.utils.getTextLanguage=function(c,d,e){if("undefined"==typeof c||null===c||0===c.length)throw new b(TRANSLATOR_NS.ERROR.NO_CONTENT_TO_DETECT);a.DETECT.PARAM.TEXT(c),TRANSLATOR_NS.utils.sendRequest(a.BASE_URL,a.DETECT.VERB,a.DETECT.PARAMS,a.ACCOUNT_KEY,d,e)},TRANSLATOR_NS.utils.sendRequest=function(a,c,d,e,f,g){if("undefined"==typeof a||null===a||0===a.length)throw new b(TRANSLATOR_NS.ERROR.API_BASE_URL_UNDEFINED);if("undefined"==typeof c||null===c||0===c.length)throw new b(TRANSLATOR_NS.ERROR.API_VERB_UNDEFINED);if("undefined"==typeof d||null===d||0===d.length)throw new b(TRANSLATOR_NS.ERROR.API_PARAMS_UNDEFINED);if("undefined"==typeof e||null===e||0===e.length)throw new b(TRANSLATOR_NS.ERROR.API_KEY_UNDEFINED);var h=a+"/"+c+"?";for(var i in d)h+=i+"='"+d[i]+"'",h+="&";h=h.substr(0,h.length-1);var j=encodeURI(h);$.ajax({url:j,beforeSend:function(a){var b=Base64.encode(":"+e);a.setRequestHeader("Authorization","Basic "+b)},context:this,type:"GET",success:f,error:g})};!function(){var a="";try{a=TRANSLATOR_NS.utils.getUserLanguage()}catch(b){console.log(b.toString()),console.log("Set default language to en"),a="en"}TRANSLATOR_NS.utils.setLanguage(a)}()}(),$(document).ready(function(){var a='<div id="translate-popover"><button type="button" class="translate-close"><span aria-hidden="true">×</span></button><div class="translate-arrow"></div><h3 class="translate-title"></h3><div class="translate-content"></div></div>';$(a).appendTo("body"),$(".translate-close").click(function(){$("#translate-popover").hide()});var b=function(a){$("#translate-popover").find(".translate-title").html(a)},c=function(a){$("#translate-popover").find(".translate-content").html(a),$("#translate-popover").show()},d=function(){$("#translate-popover").find(".translate-title").empty(),$("#translate-popover").find(".translate-content").empty()},e=function(){return document.getSelection().toString()},f=function(){var a={x:0,y:0},b=window.getSelection();if(b.rangeCount)if(range=b.getRangeAt(0).cloneRange(),range.getClientRects){range.collapse(!0);var c=range.getClientRects()[0];a.x=c.left,a.y=c.top}else{var d=document.createElement("span");if(d.getClientRects){d.appendChild(document.createTextNode("​")),range.insertNode(d),c=d.getClientRects()[0],a.x=c.left,a.y=c.top;var e=d.parentNode;e.removeChild(d),e.normalize()}}return a},g=function(){var a={width:0,height:0},b=document.getSelection(),c=b.getRangeAt(0).commonAncestorContainer.parentElement,d=document.createElement("div"),e="TranslatorTempDiv";d.setAttribute("id",e),d.textContent=b.toString();var f="position: absolute;height: auto;width: auto;white-space: nowrap;";return d.setAttribute("style",f),c.appendChild(d),a.width=d.clientWidth,a.height=d.clientHeight,c.removeChild(d),a},h=function(){var a,b;a=f(),b=g();var c=$("#translate-popover"),d=c.outerWidth(),e=c.outerHeight(),h=a.x+b.width/2,i=window.innerHeight-a.y;d>=window.innerWidth?c.css("left",a.x+b.width/2-d/2):d/2>=h?c.css("left",a.x+b.width):d/2>=window.innerWidth-(a.x+b.width)?c.css("left",a.x-d):c.css("left",a.x+b.width/2-d/2),e>=i?c.css("top",a.y-b.height-e):c.css("top",a.y+b.height)};$(document).scroll(function(){$("#translate-popover").hide()}),$(document).dblclick(function(){d(),h();var a=e().trim(),f=TRANSLATOR_NS.FIELD.TRANSLATION_OF+" <b>"+a+"</b>";b(f);try{TRANSLATOR_NS.utils.getTextLanguage(a,function(b){var d=$(b).find("content").children(),e=$(d[0]).children(),f=$(e[0]).text();try{TRANSLATOR_NS.utils.translate(a,f,TRANSLATOR_NS.USER_SETTINGS.LANGUAGE,function(a){var b=$(a).find("content").children(),d=$(b[0]).children(),e=$(d[0]).text();c(e)},function(a,b,d){console.log(d),c(d)})}catch(g){console.log(g.toString()),c(g.message)}},function(a,b,d){console.log(d),c(d)})}catch(g){console.log(g.toString()),c(g.message)}})});